<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í‘¸ë¥¸ë‚˜ë¼í•™êµ - ì‹ ì•™ RPG</title>
    <!-- Web App Manifest for 'Add to Home Screen' -->
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="í‘¸ë¥¸ë‚˜ë¼í•™êµ">
    
    <style>
        /* General styling for the entire page */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        /* Main application container */
        .app-container {
            max-width: 414px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* Header section with user profile */
        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }

        .character-avatar {
            width: 80px;
            height: 80px;
            background: #fff;
            border-radius: 50%;
            margin: 0 auto 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            border: 3px solid rgba(255,255,255,0.3);
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .character-avatar:hover {
            transform: scale(1.05);
        }

        .user-name {
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 5px 10px;
            border-radius: 15px;
            background: rgba(255,255,255,0.2);
            transition: all 0.3s ease;
        }

        .user-name:hover {
            background: rgba(255,255,255,0.3);
        }

        .user-stats {
            display: flex;
            justify-content: space-around;
            margin-top: 15px;
            font-size: 14px;
        }

        .stat {
            text-align: center;
        }

        .stat-value {
            font-weight: bold;
            font-size: 18px;
        }

        /* Bottom navigation bar */
        .navigation {
            display: flex;
            background: #f8f9fa;
            border-top: 1px solid #dee2e6;
            flex-shrink: 0;
        }

        .nav-item {
            flex: 1;
            padding: 15px 10px;
            text-align: center;
            background: none;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 12px;
            color: #495057;
        }

        .nav-item.active {
            background: #4facfe;
            color: white;
        }

        .nav-item:hover {
            background: #e9ecef;
        }

        .nav-item.active:hover {
            background: #3d8bfe;
        }

        /* Main content area */
        .content {
            padding: 20px;
            flex-grow: 1;
            overflow-y: auto;
        }

        /* Styling for mission cards on the home tab */
        .mission-card {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .mission-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .mission-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .mission-title {
            font-weight: bold;
        }

        .mission-reward {
            background: #ffd700;
            color: #333;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }

        .mission-description {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
        }

        .mission-button {
            background: #4facfe;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .mission-button:hover {
            background: #3d8bfe;
            transform: scale(1.05);
        }

        .mission-button:disabled {
            background: #28a745;
            cursor: not-allowed;
            transform: none;
        }

        /* Utility class to hide elements */
        .hidden {
            display: none;
        }

        /* Floating notification style */
        .floating-notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #28a745;
            color: white;
            padding: 15px 20px;
            border-radius: 25px;
            font-weight: bold;
            animation: slideInDown 0.3s ease;
            z-index: 999;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        @keyframes slideInDown {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        /* 10-10-10 prayer card styling */
        .prayer-time-card {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
            text-align: center;
        }

        .prayer-time-title {
            font-size: 18px;
            font-weight: bold;
            color: #8b4513;
            margin-bottom: 15px;
        }

        .prayer-time-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        .prayer-time-slot {
            background: rgba(255,255,255,0.7);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .prayer-time-slot:hover {
            border-color: #8b4513;
            transform: scale(1.05);
        }

        .prayer-time-slot.completed {
            background: #d4edda;
            border-color: #28a745;
        }

        /* Scripture display card */
        .scripture-card {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            border: 1px solid #2196f3;
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
            text-align: center;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .scripture-text {
            font-size: 16px;
            line-height: 1.6;
            color: #1565c0;
            margin-bottom: 10px;
            font-style: italic;
        }

        .scripture-reference {
            font-weight: bold;
            color: #0d47a1;
            font-size: 14px;
        }

        /* Chat interface styling */
        .chat-container {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 15px;
            margin-top: 15px;
            height: 350px;
            display: flex;
            flex-direction: column;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 15px;
            padding: 10px;
            background: white;
            border-radius: 10px;
        }

        .message {
            margin-bottom: 15px;
            display: flex;
            flex-direction: column;
        }

        .message.user {
            align-items: flex-end;
        }

        .message.other {
            align-items: flex-start;
        }

        .message-bubble {
            padding: 10px 15px;
            border-radius: 18px;
            max-width: 80%;
            word-wrap: break-word;
            display: inline-block;
        }
        
        .message.user .message-bubble {
            background: #4facfe;
            color: white;
        }

        .message.other .message-bubble {
            background: #f1f3f4;
            color: #333;
        }

        .message-header {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
            font-size: 12px;
            padding: 0 5px;
        }

        .message-avatar {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: white;
            margin-right: 8px;
        }
        
        .message.user .message-avatar { background: #3d8bfe; }
        .message.other .message-avatar { background: #6c757d; }

        .message-sender {
            font-weight: bold;
        }

        .message-time {
            margin-left: 8px;
            opacity: 0.7;
            font-size: 10px;
        }

        .chat-input-container {
            display: flex;
            gap: 10px;
        }

        .chat-input {
            flex: 1;
            padding: 12px;
            border: 1px solid #dee2e6;
            border-radius: 20px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .chat-input:focus {
            border-color: #4facfe;
            outline: none;
        }

        .chat-send-btn {
            background: #4facfe;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 20px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .chat-send-btn:hover {
            background: #3d8bfe;
        }

        /* Modal styling */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 320px;
            width: 90%;
            text-align: center;
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .modal-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #4facfe;
        }

        .modal-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .modal-input:focus {
            border-color: #4facfe;
            outline: none;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
        }

        .modal-button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .modal-button.primary {
            background: #4facfe;
            color: white;
        }

        .modal-button.primary:hover {
            background: #3d8bfe;
        }

        .modal-button.secondary {
            background: #6c757d;
            color: white;
        }

        .modal-button.secondary:hover {
            background: #5a6268;
        }

        /* Stage lesson content styling */
        .lesson-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            animation: slideInUp 0.4s ease;
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .lesson-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e9ecef;
        }

        .lesson-icon {
            font-size: 30px;
            margin-right: 15px;
        }

        .lesson-title {
            font-size: 18px;
            font-weight: bold;
            color: #4facfe;
        }

        .lesson-content {
            line-height: 1.7;
            color: #333;
            font-size: 15px;
        }

        .lesson-content h4 {
            color: #4facfe;
            margin: 20px 0 10px 0;
            font-size: 16px;
        }

        .lesson-content ul {
            margin: 10px 0;
            padding-left: 20px;
        }

        .lesson-content li {
            margin-bottom: 8px;
        }

        .lesson-content p {
            margin-bottom: 12px;
        }

        .lesson-content strong {
            color: #2c5aa0;
        }
        
        /* Stage selection cards */
        .stage-card {
            background: linear-gradient(135deg, #89f7fe 0%, #66a6ff 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .stage-card:hover {
            transform: scale(1.03);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }
        
        /* Avatar selection modal */
        .avatar-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        .avatar-option {
            font-size: 30px;
            cursor: pointer;
            padding: 10px;
            border-radius: 50%;
            transition: background 0.2s ease;
        }
        .avatar-option:hover {
            background: #e9ecef;
        }

    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <div class="header">
            <div class="character-avatar" id="headerAvatar" onclick="showAvatarModal()">ğŸŒŸ</div>
            <div class="user-name" onclick="showNameModal()">
                <span id="userName">í‘¸ë¥¸ì´</span>
                <span>âœï¸</span>
            </div>
            <div class="user-stats">
                <div class="stat">
                    <div class="stat-value" id="userLevel">5</div>
                    <div>ë ˆë²¨</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="userExp">750</div>
                    <div>ê²½í—˜ì¹˜</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="userStreak">7</div>
                    <div>ì—°ì†ì¼</div>
                </div>
            </div>
        </div>

        <!-- Content Area -->
        <div class="content">
            <!-- Home Tab -->
            <div id="home-tab" class="tab-content">
                <h3 style="margin-bottom: 15px;">ğŸ“‹ ì˜¤ëŠ˜ì˜ ë¯¸ì…˜</h3>
                
                <div class="prayer-time-card">
                    <div class="prayer-time-title">â° 10-10-10 ê¸°ë„ë²•</div>
                    <div class="prayer-time-grid">
                        <div class="prayer-time-slot" onclick="completePrayerTime('morning', this)">
                            <div>ğŸŒ… ì•„ì¹¨</div>
                            <div style="font-size: 12px;">10ë¶„</div>
                        </div>
                        <div class="prayer-time-slot" onclick="completePrayerTime('noon', this)">
                            <div>â˜€ï¸ ì ì‹¬</div>
                            <div style="font-size: 12px;">10ë¶„</div>
                        </div>
                        <div class="prayer-time-slot" onclick="completePrayerTime('evening', this)">
                            <div>ğŸŒ™ ì €ë…</div>
                            <div style="font-size: 12px;">10ë¶„</div>
                        </div>
                    </div>
                </div>

                <div class="mission-card">
                    <div class="mission-header">
                        <div class="mission-title">ğŸ“– ì„±ê²½ ë§ì”€ ì½ê¸°</div>
                        <div class="mission-reward">+70 EXP</div>
                    </div>
                    <div class="mission-description">í‘¸ë¥¸ë°”ëŒì˜ ëƒ‰ì¥ê³ ì—ì„œ ì˜¤ëŠ˜ì˜ ì˜ì–‘ë¶„ì„ ì„­ì·¨í•˜ì„¸ìš”</div>
                    <button class="mission-button" onclick="showScripture()">ë§ì”€ ë³´ê¸°</button>
                    <div id="scripture-container"></div>
                </div>

                <div class="mission-card">
                    <div class="mission-header">
                        <div class="mission-title">ğŸ¯ ì˜ˆë°° ì°¸ì—¬í•˜ê¸°</div>
                        <div class="mission-reward">+100 EXP</div>
                    </div>
                    <div class="mission-description">í•˜ë‚˜ë‹˜ì„ ë§Œë‚˜ëŠ” ê³µì‹ ì±„ë„ì—ì„œ ì–‘ë°©í–¥ ì†Œí†µí•˜ì„¸ìš”</div>
                    <button class="mission-button" onclick="completeMission(this, 'ì˜ˆë°° ì°¸ì—¬ ì™„ë£Œ! ìš©íŠ¹ìƒˆ ë©”ì‹œì§€ë¥¼ ë°›ì•˜ìŠµë‹ˆë‹¤! ğŸ™', 100)">ì°¸ì—¬ ì™„ë£Œ</button>
                </div>

                <div class="mission-card">
                    <div class="mission-header">
                        <div class="mission-title">ï¿½ ê¸¸ë“œì›ê³¼ ëŒ€í™”í•˜ê¸°</div>
                        <div class="mission-reward">+30 EXP</div>
                    </div>
                    <div class="mission-description">ë³‘ì•„ë¦¬ ê³µë™ì²´ì—ì„œ ê¸¸ë“œ ë²„í”„ë¥¼ ë°›ì•„ë³´ì„¸ìš”</div>
                    <button class="mission-button" onclick="openChat()">ì±„íŒ… ì°¸ì—¬</button>
                    <div id="chat-container"></div>
                </div>
            </div>

            <!-- Stages Tab -->
            <div id="stages-tab" class="tab-content hidden">
                 <div id="stage-list">
                    <h3 style="margin-bottom: 20px;">ğŸ¯ í•™ìŠµ ìŠ¤í…Œì´ì§€</h3>
                    <p style="text-align: center; color: #666; margin-bottom: 20px;">
                        êµì¬ ë‚´ìš© ê¸°ë°˜ í•™ìŠµ ë‹¨ê³„ì…ë‹ˆë‹¤
                    </p>
                    
                    <div class="stage-card" onclick="enterStage(1)">
                        <div style="font-size: 18px; font-weight: bold; margin-bottom: 5px;">1. íŒ¨ì¹˜ ì‹œìŠ¤í…œ</div>
                        <div style="font-size: 14px; opacity: 0.9;">ê±°ë¶€í•  ìˆ˜ ì—†ëŠ” íŠ¹ê¶Œ</div>
                        <div style="font-size: 12px; margin-top: 5px; opacity: 0.8;">ì˜ˆë°°í•˜ê¸° â€¢ ì„±ê²½ì½ê¸° â€¢ ê¸°ë„í•˜ê¸°</div>
                    </div>

                    <div class="stage-card" onclick="enterStage(2)">
                        <div style="font-size: 18px; font-weight: bold; margin-bottom: 5px;">2. ê¸¸ë“œ ì‹œìŠ¤í…œ</div>
                        <div style="font-size: 14px; opacity: 0.9;">ìš°ë¦¬, ê°™ì´ í•´ë³¼ê¹Œìš”</div>
                        <div style="font-size: 12px; margin-top: 5px; opacity: 0.8;">ì„¸ë¡€ë°›ê¸° â€¢ ê³µë™ì²´ ì†í•˜ê¸° â€¢ ì„±ë ¹ ë”°ë¥´ê¸°</div>
                    </div>

                    <div class="stage-card" onclick="enterStage(3)">
                        <div style="font-size: 18px; font-weight: bold; margin-bottom: 5px;">3. ì‹¤ì „ ì‹œìŠ¤í…œ</div>
                        <div style="font-size: 14px; opacity: 0.9;">ì¸ìƒì€ ì¥ë‚œì´ ì•„ë‹ˆë‹ˆê¹Œ</div>
                        <div style="font-size: 12px; margin-top: 5px; opacity: 0.8;">ì´ë¡ ì—ì„œ í˜„ì‹¤ë¡œ â€¢ ë§¤ì¼ ê·¸ë¶„ê³¼ â€¢ ì¼ìƒì„ í•¨ê»˜</div>
                    </div>
                </div>
                
                <div id="stage-detail" class="hidden">
                    <div id="stage-content"></div>
                    <button style="background: #6c757d; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; margin-top: 20px; width: 100%;" onclick="backToStages()">â† ìŠ¤í…Œì´ì§€ ëª©ë¡ìœ¼ë¡œ</button>
                </div>
            </div>

            <!-- Guild Tab -->
            <div id="guild-tab" class="tab-content hidden">
                <div style="background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); padding: 20px; border-radius: 15px; margin-bottom: 20px; text-align: center; position: relative;">
                    <h3>ğŸ‘¥ í‘¸ë¥¸ë°”ëŒë‹¨</h3>
                    <strong>ê¸¸ë“œ ë ˆë²¨: <span id="guildLevel">12</span></strong><br>
                    <small>ë‹¤ìŒ ë ˆë²¨ê¹Œì§€ <span id="guildExp">350</span>/500 EXP</small>
                </div>

                <h4 style="margin-bottom: 15px;">ğŸŸ¢ í˜„ì¬ ì ‘ì† ì¤‘ì¸ ê¸¸ë“œì›</h4>
                <div style="background: #f8f9fa; border-radius: 15px; padding: 15px; margin-bottom: 15px;">
                    <div style="display: flex; align-items: center; padding: 10px; margin-bottom: 8px; background: white; border-radius: 10px;">
                        <div id="guildUserAvatar" style="width: 45px; height: 45px; border-radius: 50%; margin-right: 12px; display: flex; align-items: center; justify-content: center; font-size: 20px; border: 2px solid #4facfe; background: #4facfe; color: white;">ğŸŒŸ</div>
                        <div style="flex: 1;">
                            <div style="font-weight: bold; margin-bottom: 2px;"><span id="guildUserName">í‘¸ë¥¸ì´</span> (ë‚˜)</div>
                            <div style="font-size: 12px; color: #666;">ë ˆë²¨ <span id="guildUserLevel">5</span> â€¢ <span id="guildUserStreak">7</span>ì¼ ì—°ì† ì ‘ì†</div>
                        </div>
                    </div>
                    <div style="text-align: center; color: #666; padding: 20px;">
                        <p>ë‹¤ë¥¸ ê¸¸ë“œì›ë“¤ì´ ì ‘ì†í•˜ë©´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</p>
                        <p>ì¹œêµ¬ë“¤ì„ ì´ˆëŒ€í•´ë³´ì„¸ìš”! ğŸ‰</p>
                    </div>
                </div>

                <div style="margin-top: 20px;">
                    <button style="width: 100%; padding: 15px; background: #28a745; color: white; border: none; border-radius: 10px; font-weight: bold;" onclick="showGuildChat()">
                        ğŸ’¬ ê¸¸ë“œ ì±„íŒ… ì°¸ì—¬í•˜ê¸°
                    </button>
                    <div id="guild-chat-container" style="margin-top: 15px;"></div>
                </div>
            </div>

            <!-- Profile Tab -->
            <div id="profile-tab" class="tab-content hidden">
                <div style="background: #f8f9fa; border-radius: 15px; padding: 20px; margin-bottom: 20px;">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="width: 100px; height: 100px; border-radius: 50%; margin: 0 auto 15px; display: flex; align-items: center; justify-content: center; font-size: 50px; cursor: pointer; border: 3px solid #4facfe; background: white;" id="profileAvatar" onclick="showAvatarModal()">ğŸŒŸ</div>
                        <div>
                            <h4 id="profileUserName" style="margin-bottom: 5px; color: #333;">í‘¸ë¥¸ì´</h4>
                            <p style="color: #666; font-size: 14px;">ë ˆë²¨ <span id="profileLevel">5</span> <span id="profileJob">ìƒˆì‹ ì</span></p>
                            <p style="color: #666; font-size: 14px;">ì‹ ì•™ ì—¬ì • <span id="profileStreak">7</span>ì¼ì°¨</p>
                        </div>
                    </div>
                </div>

                <div style="background: #f8f9fa; border-radius: 15px; padding: 20px; margin-bottom: 20px;">
                    <h4 style="margin-bottom: 15px;">ğŸ† ì—…ì  ë° ë±ƒì§€</h4>
                    <div style="background: white; padding: 15px; border-radius: 10px;">
                        <div style="margin-bottom: 10px;">
                            <span style="display: inline-block; background: #ffd700; color: #333; padding: 5px 10px; border-radius: 15px; font-size: 12px; font-weight: bold; margin: 2px;">ì²« ê¸°ë„</span>
                            <span style="display: inline-block; background: #ffd700; color: #333; padding: 5px 10px; border-radius: 15px; font-size: 12px; font-weight: bold; margin: 2px;">ì„±ê²½ ë…ì</span>
                            <span style="display: inline-block; background: #ffd700; color: #333; padding: 5px 10px; border-radius: 15px; font-size: 12px; font-weight: bold; margin: 2px;">7ì¼ ì—°ì†</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-top: 15px; padding-top: 15px; border-top: 1px solid #e9ecef;">
                            <span>ì™„ë£Œí•œ ë¯¸ì…˜</span>
                            <strong id="completedMissionsCount">15</strong>ê°œ
                        </div>
                    </div>
                </div>

                <div style="background: #f8f9fa; border-radius: 15px; padding: 20px; margin-bottom: 20px;">
                    <h4 style="margin-bottom: 15px;">âš™ï¸ ê´€ë¦¬ì ì„¤ì •</h4>
                    <div style="background: white; padding: 15px; border-radius: 10px;">
                        <button style="width: 100%; padding: 12px; background: #dc3545; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer;" onclick="showResetModal()">
                            ğŸ”„ ë ˆë²¨/ê²½í—˜ì¹˜ ì´ˆê¸°í™”
                        </button>
                        <div style="font-size: 12px; color: #666; margin-top: 8px; text-align: center;">
                            ê´€ë¦¬ìë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Navigation -->
        <div class="navigation">
            <button class="nav-item active" onclick="showTab('home', this)">
                ğŸ <br>í™ˆ
            </button>
            <button class="nav-item" onclick="showTab('stages', this)">
                ğŸ®<br>ìŠ¤í…Œì´ì§€
            </button>
            <button class="nav-item" onclick="showTab('guild', this)">
                ğŸ‘¥<br>ê¸¸ë“œ
            </button>
            <button class="nav-item" onclick="showTab('profile', this)">
                ğŸ‘¤<br>í”„ë¡œí•„
            </button>
        </div>
    </div>

    <!-- Modals -->
    <div id="nameModal" class="modal">
        <div class="modal-content">
            <div class="modal-title">ë‹‰ë„¤ì„ ë³€ê²½</div>
            <input type="text" id="nameInput" class="modal-input" placeholder="ìƒˆë¡œìš´ ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”" maxlength="10">
            <div class="modal-buttons">
                <button class="modal-button secondary" onclick="closeNameModal()">ì·¨ì†Œ</button>
                <button class="modal-button primary" onclick="changeName()">ë³€ê²½</button>
            </div>
        </div>
    </div>

    <div id="avatarModal" class="modal">
        <div class="modal-content">
            <div class="modal-title">í”„ë¡œí•„ ì‚¬ì§„ ë³€ê²½</div>
            <div class="avatar-grid">
                <div class="avatar-option" onclick="selectAvatar('ğŸŒŸ')">ğŸŒŸ</div>
                <div class="avatar-option" onclick="selectAvatar('ğŸ˜Š')">ğŸ˜Š</div>
                <div class="avatar-option" onclick="selectAvatar('ğŸ™')">ğŸ™</div>
                <div class="avatar-option" onclick="selectAvatar('âœ¨')">âœ¨</div>
                <div class="avatar-option" onclick="selectAvatar('ğŸ•Šï¸')">ğŸ•Šï¸</div>
                <div class="avatar-option" onclick="selectAvatar('ğŸ“–')">ğŸ“–</div>
                <div class="avatar-option" onclick="selectAvatar('â¤ï¸')">â¤ï¸</div>
                <div class="avatar-option" onclick="selectAvatar('ğŸŒ…')">ğŸŒ…</div>
                <div class="avatar-option" onclick="selectAvatar('â­')">â­</div>
                <div class="avatar-option" onclick="selectAvatar('ğŸµ')">ğŸµ</div>
                <div class="avatar-option" onclick="selectAvatar('ğŸŒ¸')">ğŸŒ¸</div>
                <div class="avatar-option" onclick="selectAvatar('ğŸŒˆ')">ğŸŒˆ</div>
            </div>
            <div class="modal-buttons">
                <button class="modal-button secondary" onclick="closeAvatarModal()">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>

    <div id="resetModal" class="modal">
        <div class="modal-content">
            <div class="modal-title">ê´€ë¦¬ì ì¸ì¦</div>
            <input type="password" id="adminPassword" class="modal-input" placeholder="ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" maxlength="4">
            <div class="modal-buttons">
                <button class="modal-button secondary" onclick="closeResetModal()">ì·¨ì†Œ</button>
                <button class="modal-button primary" onclick="confirmReset()">í™•ì¸</button>
            </div>
        </div>
    </div>
    
    <script>
        // --- Global State Variables ---
        let userLevel = 5;
        let userExp = 750;
        let userStreak = 7;
        let completedMissions = 15;
        let userName = 'í‘¸ë¥¸ì´';
        let userAvatar = 'ğŸŒŸ';
        let userJob = 'ìƒˆì‹ ì';
        let guildLevel = 12;
        let guildExp = 350;
        let currentStage = null;
        let chatMessages = [];
        let prayerTimes = { morning: false, noon: false, evening: false };

        // --- Data Definitions ---

        // Scripture data for daily missions
        const scriptures = [
            { text: "ë‚´ ì•ˆì— ë¨¸ë¬¼ëŸ¬ ìˆì–´ë¼. ê·¸ë¦¬í•˜ë©´ ë‚˜ë„ ë„ˆí¬ ì•ˆì— ë¨¸ë¬¼ëŸ¬ ìˆê² ë‹¤. ê°€ì§€ê°€ í¬ë„ë‚˜ë¬´ì— ë¶™ì–´ ìˆì§€ ì•„ë‹ˆí•˜ë©´ ìŠ¤ìŠ¤ë¡œ ì—´ë§¤ë¥¼ ë§ºì„ ìˆ˜ ì—†ëŠ” ê²ƒê³¼ ê°™ì´, ë„ˆí¬ë„ ë‚´ ì•ˆì— ë¨¸ë¬¼ëŸ¬ ìˆì§€ ì•„ë‹ˆí•˜ë©´ ì—´ë§¤ë¥¼ ë§ºì„ ìˆ˜ ì—†ë‹¤.", reference: "ìš”í•œë³µìŒ 15:4" },
            { text: "ë‚˜ëŠ” ì°¸ í¬ë„ë‚˜ë¬´ìš”, ë‚´ ì•„ë²„ì§€ëŠ” ë†ë¶€ì´ì‹œë‹¤.", reference: "ìš”í•œë³µìŒ 15:1" },
            { text: "ë„ˆí¬ê°€ ë‚˜ì˜ ë§ì— ë¨¸ë¬¼ëŸ¬ ìˆìœ¼ë©´, ë„ˆí¬ëŠ” ì°¸ìœ¼ë¡œ ë‚˜ì˜ ì œìë“¤ì´ë‹¤. ê·¸ë¦¬ê³  ë„ˆí¬ëŠ” ì§„ë¦¬ë¥¼ ì–»ê²Œ ë  ê²ƒì´ë©°, ì§„ë¦¬ê°€ ë„ˆí¬ë¥¼ ììœ ë¡­ê²Œ í•  ê²ƒì´ë‹¤.", reference: "ìš”í•œë³µìŒ 8:31-32" },
            { text: "ê·¸ëŸ¬ë¯€ë¡œ ë„ˆí¬ëŠ” ê°€ì„œ, ëª¨ë“  ë¯¼ì¡±ì„ ì œìë¡œ ì‚¼ì•„ì„œ, ì•„ë²„ì§€ì™€ ì•„ë“¤ê³¼ ì„±ë ¹ì˜ ì´ë¦„ìœ¼ë¡œ ì„¸ë¡€ë¥¼ ì£¼ê³ , ë‚´ê°€ ë„ˆí¬ì—ê²Œ ëª…ë ¹í•œ ëª¨ë“  ê²ƒì„ ê·¸ë“¤ì—ê²Œ ê°€ë¥´ì³ ì§€í‚¤ê²Œ í•˜ì—¬ë¼.", reference: "ë§ˆíƒœë³µìŒ 28:19-20" },
            { text: "ì‚¬ëŒì€ ë§ˆìŒìœ¼ë¡œ ë¯¿ì–´ì„œ ì˜ì— ì´ë¥´ê³ , ì…ìœ¼ë¡œ ê³ ë°±í•´ì„œ êµ¬ì›ì— ì´ë¥´ê²Œ ë©ë‹ˆë‹¤.", reference: "ë¡œë§ˆì„œ 10:10" }
        ];

        // Stage content based on the provided PDF
        const stageContents = {
            1: {
                title: "1ê°•: íŒ¨ì¹˜ ì‹œìŠ¤í…œ - ê±°ë¶€í•  ìˆ˜ ì—†ëŠ” íŠ¹ê¶Œ",
                lessons: [
                    {
                        icon: "ğŸ›¡ï¸",
                        title: "ì˜ˆë°°í•˜ê¸° - í•˜ë‚˜ë‹˜ì„ ë§Œë‚˜ëŠ” ê³µì‹ ì±„ë„",
                        content: `
                            <h4>ğŸ“Œ ì˜ˆë°°ëŠ” ì–‘ë°©í–¥ ì†Œí†µ</h4>
                            <p>ì˜ˆìˆ˜ë‹˜ì€ ìš°ë¦¬ì—ê²Œ ìƒˆë¡œìš´ ìƒëª…ì„ ì£¼ì‹¤ ë¿ë§Œ ì•„ë‹ˆë¼, "ë” ë„˜ì¹˜ê²Œ" ëˆ„ë¦¬ë©° ì‚´ê²Œ í•˜ê¸° ìœ„í•´ ìê¸° ëª©ìˆ¨ì„ ë²„ë¦¬ê² ë‹¤ê³  ë§ì”€í•˜ì…¨ìŠµë‹ˆë‹¤.</p>
                            <h4>ğŸ’¡ ì˜ˆë°°ì˜ ì˜ë¯¸</h4>
                            <ul>
                                <li>í•˜ë‚˜ë‹˜ì´ ìš°ë¦¬ ì¼ìƒì— ì–¼ë§ˆë‚˜ ê´€ì‹¬ì´ ë§ì€ì§€ ì•Œ ìˆ˜ ìˆëŠ” ì‹œê°„</li>
                                <li>ìš°ë¦¬ë¥¼ ì–¼ë§ˆë‚˜ ì†Œì¤‘íˆ ì—¬ê¸°ëŠ”ì§€ ê¹¨ë‹«ëŠ” ì‹œê°„</li>
                                <li>í•˜ë‚˜ë‹˜ì˜ ê³„íšì—ì„œ ìš°ë¦¬ê°€ ì–¼ë§ˆë‚˜ ì¤‘ìš”í•œ ì‚¬ëŒì¸ì§€ ë°œê²¬í•˜ëŠ” ì‹œê°„</li>
                            </ul>
                            <h4>ğŸ¯ ì‹¤ì²œ ë°©ë²• - ë§ˆìŒìœ¼ë¡œ ë“œë¦¬ëŠ” ì˜ˆë°°</h4>
                            <ul>
                                <li>ì˜ˆë°° ì¤‘ì— ìˆ˜ì²©ì´ë‚˜ ë‹¤ì´ì–´ë¦¬ì— í•˜ë‚˜ë‹˜ê»˜ ë“œë¦¬ëŠ” ë§ˆìŒì„ ê¸°ë¡í•˜ê¸°</li>
                                <li>"ì˜¤ëŠ˜ì€ í•˜ë‚˜ë‹˜ì´ ì˜ˆë°°ì—ì„œ ì–´ë–¤ ì´ì•¼ê¸°ë¥¼ í•´ì£¼ì‹¤ê¹Œ?" ê¸°ëŒ€í•˜ë©° ì°¸ì—¬í•˜ê¸°</li>
                                <li>ì°¬ì–‘ê³¼ ê¸°ë„ë¡œ í•˜ë‚˜ë‹˜ì„ ë†’ì´ê³ , ì„¤êµë¥¼ í†µí•´ ë§ì”€ì„ ë“£ê³  ê¹¨ë‹¬ì€ í›„ ê³ ë°±ê³¼ ë‹¤ì§ìœ¼ë¡œ ë§ˆìŒ í‘œí˜„í•˜ê¸°</li>
                            </ul>
                            <h4>âš”ï¸ ê±°ì§“ ìœ„í˜‘ vs ì§„ì§œ ëª©ì†Œë¦¬</h4>
                            <p><strong>ê±°ì§“ ìœ„í˜‘:</strong> "ë„ˆëŠ” ì™œ ê·¸ê±°ë°–ì— ì•ˆ ë˜ëƒ?", "ë„ˆ ë”°ìœ„ëŠ” ì—¬ê¸°ì„œ ì‹¤íŒ¨í•˜ë©´ ë°”ë¡œ ëì´ì•¼"</p>
                            <p><strong>ì§„ì§œ ëª©ì†Œë¦¬ (ìš©íŠ¹ìƒˆ):</strong></p>
                            <ul>
                                <li>ê·¸ë¦¬ìŠ¤ë„ ì•ˆì—ì„œ ë‹¹ì‹ ì€ <strong>ìš©ë‚©</strong>ë˜ì—ˆìŠµë‹ˆë‹¤</li>
                                <li>ê·¸ë¦¬ìŠ¤ë„ ì•ˆì—ì„œ ë‹¹ì‹ ì€ <strong>íŠ¹ë³„í•œ</strong> ì¡´ì¬ì…ë‹ˆë‹¤</li>
                                <li>ê·¸ë¦¬ìŠ¤ë„ ì•ˆì—ì„œ ë‹¹ì‹ ì€ <strong>ìƒˆë¡œìš´</strong> ê³µë™ì²´ì— ì†í–ˆìŠµë‹ˆë‹¤</li>
                            </ul>
                        `
                    },
                    {
                        icon: "âš¡",
                        title: "ì„±ê²½ì½ê¸° - í‘¸ë¥¸ë°”ëŒì˜ ëƒ‰ì¥ê³ ",
                        content: `
                            <h4>ğŸ¯ ë‚˜ì˜ íŒ¨ì¹˜, ë‚˜ì˜ íŠ¹ê¶Œ</h4>
                            <p>ì„±ê²½ì€ í‘¸ë¥¸ë°”ëŒì˜ ë‚˜ë¼ ì—ë„ˆì§€ì›ì´ ê°€ë“í•œ ëƒ‰ì¥ê³ ì…ë‹ˆë‹¤. ì•„ë¬´ë¦¬ ëƒ‰ì¥ê³ ì— ë¨¹ì„ ê²ƒì´ ê°€ë“í•´ë„ êº¼ë‚´ ë¨¹ì§€ ì•Šìœ¼ë©´ ì•„ë¬´ ì†Œìš©ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                            <h4>ğŸ’­ ì„±ê²½ ì½ê¸°ëŠ” íŠ¹ê¶Œì¸ê°€ìš”, ì˜ë¬´ì¸ê°€ìš”?</h4>
                            <p>ì„±ê²½ ì½ê¸°ëŠ” íŠ¹ê¶Œì´ì ì˜ë¬´ì´ì§€ë§Œ, ê²°êµ­ì€ íŠ¹ê¶Œì…ë‹ˆë‹¤! ë•ì§ˆí•˜ëŠ” ìŠ¤íƒ€ì™€ ì´ì•¼ê¸° ë‚˜ëˆŒ ìˆ˜ ìˆëŠ” ì±„íŒ…ë°©ì— ì´ˆëŒ€ë°›ì€ ê²ƒê³¼ ê°™ìŠµë‹ˆë‹¤.</p>
                            <h4>ğŸ” ì„±ê²½ì„ êº¼ë‚´ ë¨¹ëŠ” ê¿€íŒ</h4>
                            <p>ì„±ê²½ ì½ê¸° ì´ˆë³´ìë¼ë©´ ë‹¤ìŒ ì£¼ì œë¥¼ ëˆˆì—¬ê²¨ ë³´ì„¸ìš”:</p>
                            <ul>
                                <li><strong>í•˜ë‚˜ë‹˜ì€ ì–´ë–¤ ë¶„ì¼ê¹Œ?</strong> (í•˜ë‚˜ë‹˜ì˜ ì„±í’ˆê³¼ ë§ì”€ê³¼ í•˜ì‹  ì¼)</li>
                                <li><strong>ì˜ˆìˆ˜ë‹˜ì€ ì–´ë–¤ ë¶„ì¼ê¹Œ?</strong> (ì˜ˆìˆ˜ë‹˜ì˜ ê°€ë¥´ì¹¨ê³¼ ì‚¶ê³¼ í–‰ë™)</li>
                                <li><strong>ì„ ë°°ë“¤ì€ ì–´ë–»ê²Œ ì‚´ì•˜ì„ê¹Œ?</strong> (ê·¸ë“¤ì˜ ë¯¿ìŒê³¼ ê¸°ë„, ì‹¤ìˆ˜ì™€ íšŒë³µê³¼ êµí›ˆ)</li>
                                <li><strong>ê·¸ëŸ¬ë©´ ë‚˜ëŠ” ì–´ë–»ê²Œ ì‚´ì•„ì•¼ í• ê¹Œ?</strong> (ë‚´ í˜„ì‹¤ì— ì ìš©í•  ìˆ˜ ìˆëŠ” ì„±ê²½ ì›ë¦¬)</li>
                            </ul>
                            <h4>ğŸ“š ìƒí™©ë³„ ì„±ê²½ ë§ì”€ ê°€ì´ë“œ</h4>
                            <ul>
                                <li><strong>ìš•ì´ë¼ë„ ì‹¤ì»· í•˜ê³  ì‹¶ì„ ë•Œ:</strong> ì‹œí¸ (ë¶„ë…¸ì˜ ì‹œê°€ ë§ìŠµë‹ˆë‹¤)</li>
                                <li><strong>ë¯¿ìŒì˜ ëª¨í—˜ì´ ë§ì„¤ì—¬ì§ˆ ë•Œ:</strong> ì—­ì‚¬ì„œë“¤ (ì—­ì‚¬ìƒ ê°€ì¥ í° ëª¨í—˜ì€ í•˜ë‚˜ë‹˜ì˜ ëª¨í—˜)</li>
                                <li><strong>ìŠ¤ìŠ¤ë¡œ í˜•í¸ì—†ë‹¤ê³  ëŠê»´ì§ˆ ë•Œ:</strong> ì‚¬ì‚¬ê¸°, ìš”ë‚˜ì„œ</li>
                                <li><strong>ì‚¬ë‘ì´ ë¬´ì–¸ì§€ ì•Œê³  ì‹¶ì„ ë•Œ:</strong> ë£»ê¸°, ì•„ê°€ì„œ, ìš”í•œë³µìŒ</li>
                                <li><strong>ë” ë‚˜ì€ ì‚¶ì„ ì‚´ê³  ì‹¶ì„ ë•Œ:</strong> ì‹œí¸, ì ì–¸, ì „ë„ì„œ, ì‹ ì•½ì˜ í¸ì§€ë“¤</li>
                            </ul>
                        `
                    },
                    {
                        icon: "ğŸ”Œ",
                        title: "ê¸°ë„í•˜ê¸° - ì‹ ì—ê²Œ ë¹¨ëŒ€ ê½‚ê¸°",
                        content: `
                            <h4>ğŸŒ³ í¬ë„ë‚˜ë¬´ì™€ ê°€ì§€ì˜ ê´€ê³„</h4>
                            <p>ì˜ˆìˆ˜ë‹˜ì€ ìš°ë¦¬ë¥¼ "ê°€ì§€"ë¼ê³  ë¶€ë¥´ì‹œë©°, ìì‹ ì—ê²Œ ë”± ë¶™ì–´ ìˆìœ¼ë¼ê³  í•˜ì‹­ë‹ˆë‹¤. ë‚˜ë­‡ê°€ì§€ì˜ ìµœê³  íŠ¹ê¶Œì€ ë†ë¶€(í•˜ë‚˜ë‹˜)ê°€ ë•€ í˜ë ¤ ì¼í•˜ê³  ë‚˜ë¬´(ì˜ˆìˆ˜ë‹˜)ê°€ ì—´ì‹¬íˆ ê³µê¸‰í•œ ì–‘ë¶„ì„ ê·¸ëƒ¥ ë°›ì•„ ëˆ„ë¦¬ëŠ” ê²ƒì…ë‹ˆë‹¤.</p>
                            <h4>ğŸ• 10-10-10 ê¸°ë„ë²•</h4>
                            <p><strong>ì•„ì¹¨ì— 10ë¶„:</strong></p>
                            <ul>
                                <li>"ì£¼ë‹˜, ì˜¤ëŠ˜ë„ ë‹¹ì‹  ì•ˆì— ë¨¸ë¬¼ê²Œìš”"</li>
                                <li>í•˜ë£¨ë¥¼ ì‹œì‘í•˜ë©´ì„œ ì˜ˆìˆ˜ë‹˜ì—ê²Œ ë§ì„ ê±¸ì–´ë³´ì„¸ìš”</li>
                            </ul>
                            <p><strong>ì ì‹¬ì— 10ë¶„:</strong></p>
                            <ul>
                                <li>10ë¶„ì´ë¼ë„ ê·¸ë¶„ ëª©ì†Œë¦¬ì— ê·€ë¥¼ ê¸°ìš¸ì—¬ë³´ì„¸ìš”</li>
                                <li>ë„ˆë¬´ í˜ë“  ìˆœê°„ì—ëŠ” "í•˜ë‚˜ë‹˜, ë„ì™€ì£¼ì„¸ìš”"ë¼ê³  ë§ˆìŒì†ìœ¼ë¡œ í¬ê²Œ ë¹„ëª…ì„ ì§ˆëŸ¬ë„ ê´œì°®ìŠµë‹ˆë‹¤</li>
                            </ul>
                            <p><strong>ì €ë…ì— 10ë¶„:</strong></p>
                            <ul>
                                <li>ì ë“¤ê¸° ì „ ë§ˆì§€ë§‰ 10ë¶„ì„ ë‚˜ë¬´ì— ë¶™ì–´ì„œ ì—ë„ˆì§€ë¥¼ ì¶©ë¶„íˆ ì±„ìš°ëŠ” ì‹œê°„ìœ¼ë¡œ í™œìš©</li>
                                <li>ì§§ì€ ê¸°ë„ë¬¸ìœ¼ë¡œ ì¼ê¸°ë¥¼ ì¨ë„ ì¢‹ê³ , ë‚®ì— ë¶€ë¥¸ ì°¬ì–‘ ê°€ì‚¬ë¥¼ ì ì–´ë„ ì¢‹ìŠµë‹ˆë‹¤</li>
                            </ul>
                            <h4>ğŸ¯ ê¸°ë„ì˜ í•µì‹¬</h4>
                            <p>ê¸°ë…êµ ì‹ ì•™ì€ í•˜ë‚˜ë‹˜ì˜ ì—´ë§ì´ ìš°ë¦¬ë¥¼ ì‚´ë ¸ê³ , í•˜ë‚˜ë‹˜ì˜ ê·¸ ì—´ì‹¬ì´ ì˜¤ëŠ˜ë„ ìš°ë¦¬ë¥¼ ì‚´ê²Œ í•œë‹¤ëŠ” ì‚¬ì‹¤ì„ ë¯¿ëŠ” ê²ƒì…ë‹ˆë‹¤. í¸í•˜ê²Œ ëŠ¥ë™ì ìœ¼ë¡œ ë¹¨ëŒ€ë¥¼ ê½‚ê³  ê·¸ë¶„ê»˜ ë§ì„ ê±°ì„¸ìš”!</p>
                        `
                    }
                ]
            },
            2: {
                title: "2ê°•: ê¸¸ë“œ ì‹œìŠ¤í…œ - ìš°ë¦¬, ê°™ì´ í•´ë³¼ê¹Œìš”",
                lessons: [
                    {
                        icon: "ğŸ¯",
                        title: "ì„¸ë¡€ë°›ê¸° - ê¸¸ë“œ ê°€ì…í•˜ê¸°",
                        content: `
                            <h4>ğŸ° ê¸¸ë“œ ê°€ì…ì˜ ì˜ë¯¸</h4>
                            <p>í•˜ë‚˜ë‹˜ ë‚˜ë¼ ì‚¬ëŒì´ ë˜ëŠ” ê²ƒê³¼ ê·¸ ë‚˜ë¼ ë°©ì‹ëŒ€ë¡œ ì‚¬ëŠ” ê²ƒ ì‚¬ì´ì— 'ì„¸ë¡€'ê°€ ìˆìŠµë‹ˆë‹¤. ê¸°ë…êµëŠ” ìì‹ ë§Œì˜ ì „ì¸ê²©ì  ê³ ë°±ì´ í•„ìš”í•œ ì¢…êµì´ë©°, ì ˆëŒ€ ë‚¨ì—ê²Œ ë¬»ì–´ê°ˆ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
                            <h4>ğŸ’ ë¹„ë°€ ì—°ì• ì—ì„œ ê³µì‹ ë°œí‘œë¡œ</h4>
                            <p>ì„¸ë¡€ë¥¼ ì¢€ ë” ì„¤ë ˆëŠ” ë²„ì „ìœ¼ë¡œ ì„¤ëª…í•˜ë©´, ë¹„ë°€ ì—°ì• ë¥¼ í•˜ëŠ” ì—°ì¸ì´ ì‚¬ê·„ë‹¤ê³  ê³µì‹ì ìœ¼ë¡œ ë°íˆëŠ” ê²ƒê³¼ ê°™ìŠµë‹ˆë‹¤. ì´ ì‚¬ëŒì´ë¼ê³  í™•ì‹ í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.</p>
                            <h4>ğŸ’« ë§ˆìŒì—ì„œ ì…ìœ¼ë¡œ</h4>
                            <p>"ì‚¬ëŒì€ ë§ˆìŒìœ¼ë¡œ ë¯¿ì–´ì„œ ì˜ì— ì´ë¥´ê³ , ì…ìœ¼ë¡œ ê³ ë°±í•´ì„œ êµ¬ì›ì— ì´ë¥´ê²Œ ë©ë‹ˆë‹¤" (ë¡œë§ˆì„œ 10:10)</p>
                            <ul>
                                <li>ì„¸ë¡€ì‹ì—ëŠ” ì§§ë”ë¼ë„ ê³µë™ì²´ ì•ì—ì„œ ìê¸° ì‹ ì•™ì„ ê³ ë°±í•˜ê³  ê¸°ë„í•˜ëŠ” ì‹œê°„ì´ ìˆìŠµë‹ˆë‹¤</li>
                                <li>ì„¸ë¡€ ê°„ì¦ë¬¸ì´ë‚˜ ê¸°ë„ë¬¸ì„ ì‘ì„±í•´ ê°„ì§í•˜ëŠ” ê²ƒì„ ì¶”ì²œí•©ë‹ˆë‹¤</li>
                            </ul>
                            <h4>ğŸ†• ì…ì—ì„œ í–‰ë™ìœ¼ë¡œ</h4>
                            <p>ì„¸ë¡€ í›„ì˜ ì‚¶ì´ ì¤‘ìš”í•©ë‹ˆë‹¤. ê²°í˜¼ì‹ë³´ë‹¤ ê·¸ í›„ì˜ ì‚¶ì´ ë” ì¤‘ìš”í•œ ê²ƒê³¼ ê°™ìŠµë‹ˆë‹¤. í•˜ë‚˜ë‹˜ ë‚˜ë¼ ì‚¬ëŒì€ ë” ì´ìƒ ìê¸°ì¤‘ì‹¬ì„±ì˜ ë…¸ì˜ˆë¡œ ì‚´ì§€ ì•Šê¸° ë•Œë¬¸ì— ììœ ë¡­ìŠµë‹ˆë‹¤.</p>
                        `
                    },
                    {
                        icon: "ğŸ‘¥",
                        title: "ê³µë™ì²´ ì†í•˜ê¸° - ë³‘ì•„ë¦¬ ê³µë™ì²´",
                        content: `
                            <h4>ğŸ£ ë³‘ì•„ë¦¬ê°€ ì‚´ì•„ë‚¨ëŠ” ë²•</h4>
                            <p>í•™êµ ì•ì—ì„œ ì‚° ë³‘ì•„ë¦¬ ì¤‘ì—ì„œ ìœ ì¼í•˜ê²Œ ëê¹Œì§€ ìë¼ì„œ íŠ¼íŠ¼í•œ ë‹­ì´ ëœ ë³‘ì•„ë¦¬ì˜ ë¹„ë°€ì€ 'ê³µë™ì²´'ì˜€ìŠµë‹ˆë‹¤. ìƒˆë¡œìš´ ê³µë™ì²´ë¥¼ ë§Œë‚˜ì„œ ë¬´ì—‡ì€ ë¨¹ê³  ë¬´ì—‡ì€ ë¨¹ì§€ ë§ì•„ì•¼ í•˜ëŠ”ì§€, ë¬¼ì€ ì–´ë–»ê²Œ ë§ˆì‹œê³  ë°”ëŒì€ ì–´ë–»ê²Œ ì¬ëŠ”ì§€ë¥¼ ì„ ë°°ì™€ ì–´ë¥¸ë“¤ì—ê²Œ ë°°ìš°ë©° ì ì  ë” ê±´ê°•í•´ì¡ŒìŠµë‹ˆë‹¤.</p>
                            <h4>ğŸ® ê¸¸ë“œ ë²„í”„ ë°›ëŠ” ë°©ë²•</h4>
                            <p><strong>1. ë“£ê³  ë°°ìš°ëŠ” ë²„í”„</strong></p>
                            <ul>
                                <li>ì˜ˆë°° ë•Œ ë“œë¦¬ëŠ” ì°¬ì–‘ê³¼ ê¸°ë„, ì„ í¬ë˜ëŠ” ì„¤êµë¥¼ ê·€ ê¸°ìš¸ì—¬ ë“£ê¸°</li>
                                <li>ì¹œêµ¬Â·ì„ ë°°ë“¤ê³¼ ì†Œê·¸ë£¹ìœ¼ë¡œ ëª¨ì—¬ì„œ í•˜ë‚˜ë‹˜ì´ ì„¤êµë¥¼ í†µí•´ í•˜ì‹  ë§ì”€ì„ ë‚˜ëˆ„ê¸°</li>
                            </ul>
                            <p><strong>2. ë³´ê³  ë°°ìš°ëŠ” ë²„í”„</strong></p>
                            <ul>
                                <li>ê³µë™ì²´ì˜ ëˆ„êµ°ê°€ê°€ ë“£ê³  ë°°ìš´ ë°”ë¥¼ ì‹¤ì œë¡œ ì‚´ì•„ë‚´ëŠ” ëª¨ìŠµì„ ë³´ë©´ì„œ ì„œë¡œ ë°°ìš°ê¸°</li>
                                <li>ì‹¤íŒ¨ë‹´ë„ ë§¤ìš° ì†Œì¤‘í•©ë‹ˆë‹¤ - ê²°ë‹¨í•˜ê³  ì‹¤ì²œí–ˆì„ ë•Œ ì¼ì–´ë‚˜ëŠ” ì¼ì´ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤</li>
                            </ul>
                            <h4>ğŸš« ì ë‹¹í•œ ê±°ë¦¬ì˜ í•¨ì •</h4>
                            <p>ì ë‹¹í•œ ê±°ë¦¬ë¥¼ ìœ ì§€í•˜ëŠ” ê³µë™ì²´ëŠ” ë‹µì´ ì•„ë‹™ë‹ˆë‹¤. ê±°ë¦¬ë¥¼ ì ë‹¹í•˜ê²Œ ìœ ì§€í•˜ë©´ ìƒì²˜ë„ ëœ ë°›ê³  ë¶ˆí¸í•˜ì§€ ì•Šì§€ë§Œ, ì„±ì¥ì„ ì„œë¡œ ê²©ë ¤í•˜ê³  ë„ëª¨í•  ìˆ˜ëŠ” ì—†ìŠµë‹ˆë‹¤. 'ê¸¸ë“œ ë²„í”„'ê°€ ìƒê¸°ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
                        `
                    },
                    {
                        icon: "ğŸ•Šï¸",
                        title: "ì„±ë ¹ ë”°ë¥´ê¸° - ìš°ë¦¬ í˜ë§Œìœ¼ë¡œëŠ” ì–´ë ¤ì›Œ",
                        content: `
                            <h4>ğŸ¤ ëŠ˜ í•¨ê»˜í•˜ëŠ” ì°¸ ì¢‹ì€ ìŠ¤ìŠ¹</h4>
                            <p>ìš°ë¦¬ í˜ë§Œìœ¼ë¡œëŠ” ì–´ë µìŠµë‹ˆë‹¤. ì–µì§€ë¡œëŠ” No, ì¸ê²©ì ìœ¼ë¡œ Yes! ì„±ë ¹ë‹˜ì€ ìš°ë¦¬ì™€ ì¸ê²©ì ì¸ ê´€ê³„ë¥¼ ì›í•˜ì‹­ë‹ˆë‹¤.</p>
                            <h4>ğŸ“–â•ğŸ•Šï¸ ì„±ê²½ê³¼ ì„±ë ¹ì˜ ì½¤ë³´</h4>
                            <p>ì„±ê²½ê³¼ ì„±ë ¹ë‹˜ì€ ë”°ë¡œ ë–¼ì–´ë†“ê³  ìƒê°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì„±ê²½ì€ ì„±ë ¹ë‹˜ì´ ê°ë™í•˜ì—¬ ê¸°ë¡í•˜ê²Œ í•˜ì‹  í•˜ë‚˜ë‹˜ì˜ ë§ì”€ì´ê³ , ì„±ë ¹ë‹˜ì€ ê·¸ ë§ì”€ì„ ìš°ë¦¬ê°€ ê¹¨ë‹«ê³  ìˆœì¢…í•  ìˆ˜ ìˆë„ë¡ ë„ìš°ì‹œëŠ” ë¶„ì´ì‹­ë‹ˆë‹¤.</p>
                            <h4>ğŸ¯ ì´ì œ ì‹¤ì „ìœ¼ë¡œ</h4>
                            <ul>
                                <li>ì„±ë ¹ë‹˜ê»˜ ì˜ì¡´í•˜ë˜ ì¸ê²©ì ìœ¼ë¡œ ì†Œí†µí•˜ì„¸ìš”</li>
                                <li>ì¼ìƒì—ì„œ ì„±ë ¹ë‹˜ì˜ ì¸ë„í•˜ì‹¬ì„ êµ¬í•˜ì„¸ìš”</li>
                                <li>ì„±ë ¹ë‹˜ì˜ ì—´ë§¤: ì‚¬ë‘, ê¸°ì¨, í‰í™”, ì˜¤ë˜ ì°¸ìŒ, ì¹œì ˆ, ì„ í•¨, ì‹ ì‹¤í•¨, ì˜¨ìœ , ì ˆì œ</li>
                            </ul>
                        `
                    }
                ]
            },
            3: {
                title: "3ê°•: ì‹¤ì „ ì‹œìŠ¤í…œ - ì¸ìƒì€ ì¥ë‚œì´ ì•„ë‹ˆë‹ˆê¹Œ",
                lessons: [
                    {
                        icon: "ğŸ“–â†’ğŸŒ",
                        title: "ì´ë¡ ì—ì„œ í˜„ì‹¤ë¡œ - ì„±ê²½ì€ ê·¸ë¦¼ì˜ ë–¡ì´ ì•„ë‹ˆë‹¤",
                        content: `
                            <h4>ğŸ“š ë¬´ì±…ì„í•œ ë™í™”ì—ì„œ ì±…ì„ê° ì©ŒëŠ” í˜„ì‹¤ë¡œ</h4>
                            <p>ê³µì£¼ë‹˜ê³¼ ì™•ìë‹˜ì´ ë§Œë‚˜ì„œ ì˜¤ë˜ì˜¤ë˜ í–‰ë³µí•˜ê²Œ ì‚´ì•˜ë‹¤ëŠ” ê²°ë§ì€ ë¬´ì±…ì„í•˜ê³  ë¹„í˜„ì‹¤ì ì…ë‹ˆë‹¤. ê·¸ í›„ì— ì–´ë–»ê²Œ ì‚´ì•˜ëŠ”ì§€ë¥¼ ë§í•´ì£¼ì–´ì•¼ ì§„ì§œ ì´ì•¼ê¸°ê°€ ì™„ì„±ë©ë‹ˆë‹¤.</p>
                            <h4>ğŸ¯ ëë‚  ë•Œê¹Œì§€ ëë‚œ ê²Œ ì•„ë‹ˆë‹¤</h4>
                            <ul>
                                <li>ì¼ìƒ ìƒí™©ì—ì„œ ì„±ê²½ ì›ë¦¬ ì ìš©í•´ë³´ê¸°</li>
                                <li>í•˜ë‚˜ë‹˜ ë‚˜ë¼ ë°©ì‹ìœ¼ë¡œ ë¬¸ì œ í•´ê²°í•˜ê¸°</li>
                                <li>ì‹¤íŒ¨í•´ë„ ê´œì°®ìŠµë‹ˆë‹¤ - ê³„íšì„ ìˆ˜ì •í•´ì„œ ë‹¤ì‹œ ë„ì „í•˜ì„¸ìš”</li>
                            </ul>
                        `
                    },
                    {
                        icon: "â°",
                        title: "ë§¤ì¼ ê·¸ë¶„ê³¼ - ë£¨í‹´! ì¬ë°Œê³  ê¾¸ì¤€í•˜ê²Œ",
                        content: `
                            <h4>ğŸ“… ì¼ëŒ€ì¼ ë§Œë‚¨ì´ë¼ë‹ˆ</h4>
                            <p>í•˜ë‚˜ë‹˜ê³¼ì˜ ê°œì¸ì ì¸ ë§Œë‚¨ ì‹œê°„ì„ ê°€ì§€ì„¸ìš”. ì¬ë°Œê³  ê¾¸ì¤€í•˜ê²Œ ë£¨í‹´ì„ ë§Œë“¤ì–´ë³´ì„¸ìš”. ì´ê²ƒì´ ë°”ë¡œ íí‹°(QT, Quiet Time)ì…ë‹ˆë‹¤.</p>
                            <h4>ğŸ“– íí‹°, ì‹œì‘í•´ë³¼ê¹Œìš”</h4>
                            <p><strong>ê¸°ë³¸ íí‹° ìˆœì„œ:</strong></p>
                            <ul>
                                <li><strong>1ë‹¨ê³„:</strong> ì„±ê²½ ë³¸ë¬¸ ì½ê¸°</li>
                                <li><strong>2ë‹¨ê³„:</strong> í•˜ë‚˜ë‹˜ì´ ëˆ„êµ¬ì‹ ì§€, ë¬´ì—‡ì„ ì›í•˜ì‹œëŠ”ì§€ ì°¾ì•„ë³´ê¸°</li>
                                <li><strong>3ë‹¨ê³„:</strong> ë‚´ê²Œ ì£¼ì‹œëŠ” ë©”ì‹œì§€ëŠ” ë¬´ì—‡ì¸ì§€ ìƒê°í•´ë³´ê¸°</li>
                                <li><strong>4ë‹¨ê³„:</strong> ì˜¤ëŠ˜ í•˜ë£¨ ì–´ë–»ê²Œ ì ìš©í• ì§€ ê²°ì •í•˜ê¸°</li>
                                <li><strong>5ë‹¨ê³„:</strong> ê¸°ë„ë¡œ ë§ˆë¬´ë¦¬í•˜ê¸°</li>
                            </ul>
                        `
                    },
                    {
                        icon: "ğŸ¤—",
                        title: "ì¼ìƒì„ í•¨ê»˜ - ì–´, ì‚´ì•„ì„œ ì›€ì§ì´ë„¤",
                        content: `
                            <h4>âœ¨ ì°¬ë€í–ˆë˜ ê·¸ ìˆœê°„</h4>
                            <p>ì¸ìƒì—ëŠ” í•˜ë‚˜ë‹˜ì˜ ì‚¬ë‘ê³¼ ì€í˜œë¥¼ íŠ¹ë³„íˆ ëŠë¼ëŠ” ì°¬ë€í•œ ìˆœê°„ë“¤ì´ ìˆìŠµë‹ˆë‹¤. ì´ëŸ° ìˆœê°„ë“¤ì„ ë†“ì¹˜ì§€ ë§ê³  ê¸°ì–µí•´ë‘ì„¸ìš”. í˜ë“  ì‹œê°„ì´ ì˜¬ ë•Œ í° ìœ„ë¡œê°€ ë©ë‹ˆë‹¤.</p>
                            <h4>ğŸŒ‘ ì–´ë‘  ì†ì— ê°‡í˜”ì„ ë•Œë„</h4>
                            <p>ëª¨ë“  ì¸ìƒì—ëŠ” ì–´ë‘ ì˜ ì‹œê°„ë„ ìˆìŠµë‹ˆë‹¤. ì´ë•Œì•¼ë§ë¡œ ì§€ê¸ˆê¹Œì§€ ìŒ“ì•„ì˜¨ ì‹ ì•™ì˜ ê·¼ìœ¡ì´ í•„ìš”í•œ ë•Œì…ë‹ˆë‹¤. í•˜ë‚˜ë‹˜ì´ í•¨ê»˜í•˜ì‹ ë‹¤ëŠ” ê²ƒì„ ë¯¿ìŒìœ¼ë¡œ ë¶™ë“¤ì–´ì•¼ í•©ë‹ˆë‹¤.</p>
                            <h4>ğŸŒˆ ê±°ë£©í•œ ìƒìƒ</h4>
                            <ul>
                                <li>í•˜ë‚˜ë‹˜ ë‚˜ë¼ì˜ ì™„ì„±ëœ ëª¨ìŠµì„ ìƒìƒí•´ë³´ì„¸ìš”</li>
                                <li>ëª¨ë“  ëˆˆë¬¼ì´ ì”»ê²¨ì§€ê³ , ëª¨ë“  ìƒì²˜ê°€ ì¹˜ìœ ë˜ëŠ” ê·¸ë‚ ì„ ê¸°ëŒ€í•˜ì„¸ìš”</li>
                                <li>ê·¸ ì†Œë§ì´ ì˜¤ëŠ˜ì˜ ì–´ë ¤ì›€ì„ ê²¬ë””ê²Œ í•˜ëŠ” í˜ì´ ë©ë‹ˆë‹¤</li>
                            </ul>
                        `
                    }
                ]
            }
        };

        // --- Core App Functions ---

        /**
         * Switches between the main tabs (Home, Stages, Guild, Profile)
         * @param {string} tabName - The name of the tab to show
         * @param {HTMLElement} navElement - The clicked navigation button element
         */
        function showTab(tabName, navElement) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.add('hidden'));
            document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
            
            document.getElementById(tabName + '-tab').classList.remove('hidden');
            navElement.classList.add('active');

            if (tabName === 'guild') updateGuildUserInfo();
            if (tabName === 'stages') backToStages(); // Always show stage list first
        }

        /**
         * Enters a specific learning stage, showing its detailed content
         * @param {number} stageNumber - The number of the stage to display
         */
        function enterStage(stageNumber) {
            currentStage = stageNumber;
            const stageData = stageContents[stageNumber];
            
            if (!stageData) {
                showNotification('ìŠ¤í…Œì´ì§€ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            document.getElementById('stage-list').classList.add('hidden');
            document.getElementById('stage-detail').classList.remove('hidden');
            
            const lessonsHtml = stageData.lessons.map(lesson => `
                <div class="lesson-container">
                    <div class="lesson-header">
                        <div class="lesson-icon">${lesson.icon}</div>
                        <div class="lesson-title">${lesson.title}</div>
                    </div>
                    <div class="lesson-content">${lesson.content}</div>
                </div>
            `).join('');
            
            const stageContentElement = document.getElementById('stage-content');
            stageContentElement.innerHTML = `
                <h3 style="margin-bottom: 20px; color: #4facfe;">${stageData.title}</h3>
                ${lessonsHtml}
            `;
            
            document.querySelector('.content').scrollTop = 0;
        }

        /**
         * Returns from the stage detail view to the stage list view
         */
        function backToStages() {
            document.getElementById('stage-detail').classList.add('hidden');
            document.getElementById('stage-list').classList.remove('hidden');
            currentStage = null;
        }

        /**
         * Completes a daily prayer time slot (morning, noon, evening)
         * @param {string} timeSlot - The prayer slot being completed
         * @param {HTMLElement} element - The clicked prayer slot element
         */
        function completePrayerTime(timeSlot, element) {
            if (prayerTimes[timeSlot]) {
                showNotification('ì´ë¯¸ ì™„ë£Œí•œ ê¸°ë„ ì‹œê°„ì…ë‹ˆë‹¤!');
                return;
            }
            
            prayerTimes[timeSlot] = true;
            element.classList.add('completed');
            
            let message = '';
            let expGain = 30;
            
            switch(timeSlot) {
                case 'morning': message = 'ğŸŒ… ì•„ì¹¨ ê¸°ë„ ì™„ë£Œ! í•˜ë£¨ë¥¼ ì£¼ë‹˜ê³¼ í•¨ê»˜ ì‹œì‘í•˜ì„¸ìš”!'; break;
                case 'noon': message = 'â˜€ï¸ ì ì‹¬ ê¸°ë„ ì™„ë£Œ! í•˜ë£¨ ì¤‘ë°˜, ì£¼ë‹˜ê»˜ ê°ì‚¬ë“œë ¤ìš”!'; break;
                case 'evening': message = 'ğŸŒ™ ì €ë… ê¸°ë„ ì™„ë£Œ! í•˜ë£¨ë¥¼ ì£¼ë‹˜ê»˜ ë§¡ê²¨ë“œë ¤ìš”!'; break;
            }
            
            addExperience(expGain, message);
            
            if (prayerTimes.morning && prayerTimes.noon && prayerTimes.evening) {
                setTimeout(() => {
                    addExperience(50, 'ğŸ‰ 10-10-10 ê¸°ë„ë²• ì™„ì£¼! ë³´ë„ˆìŠ¤ ê²½í—˜ì¹˜ +50!');
                }, 1000);
            }
            
            completedMissions++;
            updateUI();
            saveProgress();
        }

        /**
         * Displays a random scripture verse and a button to complete the mission
         */
        function showScripture() {
            const container = document.getElementById('scripture-container');
            const randomScripture = scriptures[Math.floor(Math.random() * scriptures.length)];
            
            container.innerHTML = `
                <div class="scripture-card">
                    <div class="scripture-text">"${randomScripture.text}"</div>
                    <div class="scripture-reference">- ${randomScripture.reference} -</div>
                </div>
                <button class="mission-button" onclick="completeMission(this, 'ë§ì”€ ë¬µìƒ ì™„ë£Œ! ì˜ì–‘ë¶„ì„ ì–»ì—ˆìŠµë‹ˆë‹¤! ğŸ“–', 70)" style="margin-top: 10px;">ë¬µìƒ ì™„ë£Œ</button>
            `;
        }
        
        /**
         * Handles the completion of a generic mission
         * @param {HTMLElement} button - The clicked mission button
         * @param {string} message - The notification message to show
         * @param {number} expGain - The amount of experience to award
         */
        function completeMission(button, message, expGain = 50) {
            button.textContent = 'ì™„ë£Œ!';
            button.style.background = '#28a745';
            button.disabled = true;
            
            addExperience(expGain, message);
            
            completedMissions++;
            updateUI();
            saveProgress();
        }

        /**
         * Adds experience points and checks for level up
         * @param {number} amount - The amount of EXP to add
         * @param {string} [notificationMessage] - An optional message for the notification
         */
        function addExperience(amount, notificationMessage) {
            userExp += amount;
            
            if (notificationMessage) {
                showNotification(notificationMessage);
            }

            // Check for level up
            while (userExp >= 1000) {
                userLevel++;
                userExp -= 1000;
                setTimeout(() => showNotification(`ğŸ‰ ë ˆë²¨ì—…! Lv.${userLevel} ë‹¬ì„±!`), 500);
            }
            updateUI();
        }

        // --- Chat Functions ---

        function openChat() {
            const container = document.getElementById('chat-container');
            container.innerHTML = createChatInterface('chat');
            updateChatMessages('chat');
        }

        function showGuildChat() {
            const container = document.getElementById('guild-chat-container');
            container.innerHTML = createChatInterface('guild');
            updateChatMessages('guild');
        }
        
        function createChatInterface(prefix) {
            return `
                <div class="chat-container">
                    <div class="chat-messages" id="${prefix}Messages"></div>
                    <div class="chat-input-container">
                        <input type="text" class="chat-input" id="${prefix}Input" placeholder="ê¸¸ë“œì›ë“¤ê³¼ ëŒ€í™”í•´ë³´ì„¸ìš”..." onkeypress="handleChatKeyPress(event, '${prefix}')">
                        <button class="chat-send-btn" onclick="sendMessage('${prefix}')">ì „ì†¡</button>
                    </div>
                </div>
            `;
        }

        function updateChatMessages(prefix) {
            const messagesContainer = document.getElementById(`${prefix}Messages`);
            if (!messagesContainer) return;
            
            if (chatMessages.length === 0) {
                messagesContainer.innerHTML = `<div style="text-align: center; color: #666; padding: 20px;"><p>ì²« ë²ˆì§¸ ë©”ì‹œì§€ë¥¼ ë³´ë‚´ë³´ì„¸ìš”! ğŸ’¬</p></div>`;
                return;
            }
            
            messagesContainer.innerHTML = chatMessages.map(msg => `
                <div class="message ${msg.sender === userName ? 'user' : 'other'}">
                    <div class="message-header">
                        <div class="message-avatar">${msg.avatar || 'ğŸ‘¤'}</div>
                        <div class="message-sender">${msg.sender}</div>
                        <div class="message-time">${msg.time}</div>
                    </div>
                    <div class="message-bubble">${msg.message}</div>
                </div>
            `).join('');
            
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function sendMessage(prefix) {
            const input = document.getElementById(`${prefix}Input`);
            const message = input.value.trim();
            if (message) {
                const now = new Date();
                const timeString = now.getHours().toString().padStart(2, '0') + ':' + now.getMinutes().toString().padStart(2, '0');
                
                chatMessages.push({
                    sender: userName,
                    avatar: userAvatar,
                    message: message,
                    time: timeString
                });
                input.value = '';
                
                // Update both chat views if they exist
                if (document.getElementById('chatMessages')) updateChatMessages('chat');
                if (document.getElementById('guildChatMessages')) updateChatMessages('guild');
                
                saveProgress();
            }
        }

        function handleChatKeyPress(event, prefix) {
            if (event.key === 'Enter') {
                sendMessage(prefix);
            }
        }

        // --- Modal Functions ---

        function showNameModal() {
            const modal = document.getElementById('nameModal');
            document.getElementById('nameInput').value = userName;
            modal.style.display = 'flex';
            document.getElementById('nameInput').focus();
        }
        function closeNameModal() { document.getElementById('nameModal').style.display = 'none'; }
        function changeName() {
            const newName = document.getElementById('nameInput').value.trim();
            if (newName && newName.length > 0 && newName.length <= 10) {
                userName = newName;
                updateUI();
                closeNameModal();
                showNotification('ë‹‰ë„¤ì„ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ‰');
                saveProgress();
            } else {
                showNotification('ë‹‰ë„¤ì„ì€ 1~10ì ì‚¬ì´ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”!');
            }
        }

        function showAvatarModal() { document.getElementById('avatarModal').style.display = 'flex'; }
        function closeAvatarModal() { document.getElementById('avatarModal').style.display = 'none'; }
        function selectAvatar(emoji) {
            userAvatar = emoji;
            updateUI();
            closeAvatarModal();
            showNotification('í”„ë¡œí•„ ì‚¬ì§„ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤! âœ¨');
            saveProgress();
        }

        function showResetModal() { document.getElementById('resetModal').style.display = 'flex'; }
        function closeResetModal() { document.getElementById('resetModal').style.display = 'none'; }
        function confirmReset() {
            if (document.getElementById('adminPassword').value === '0000') {
                localStorage.removeItem('blueWindProgress');
                location.reload(); // Reload to reset state to default
            } else {
                showNotification('ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤! âŒ');
            }
        }

        // --- UI and Utility Functions ---

        /**
         * Updates all relevant UI elements with current state data
         */
        function updateUI() {
            // Header
            document.getElementById('userName').textContent = userName;
            document.getElementById('headerAvatar').textContent = userAvatar;
            document.getElementById('userLevel').textContent = userLevel;
            document.getElementById('userExp').textContent = userExp;
            document.getElementById('userStreak').textContent = userStreak;
            // Profile Tab
            document.getElementById('profileUserName').textContent = userName;
            document.getElementById('profileAvatar').textContent = userAvatar;
            document.getElementById('profileLevel').textContent = userLevel;
            document.getElementById('profileJob').textContent = userJob;
            document.getElementById('profileStreak').textContent = userStreak;
            document.getElementById('completedMissionsCount').textContent = completedMissions;
            // Guild Tab
            document.getElementById('guildUserName').textContent = userName;
            document.getElementById('guildUserAvatar').textContent = userAvatar;
            document.getElementById('guildUserLevel').textContent = userLevel;
            document.getElementById('guildUserStreak').textContent = userStreak;
            document.getElementById('guildLevel').textContent = guildLevel;
            document.getElementById('guildExp').textContent = guildExp;
        }
        
        function updateGuildUserInfo() {
            updateUI(); // This now handles all UI updates
        }

        /**
         * Shows a temporary notification message at the top of the screen
         * @param {string} message - The message to display
         */
        function showNotification(message) {
            const existingNotif = document.querySelector('.floating-notification');
            if(existingNotif) existingNotif.remove();

            const notification = document.createElement('div');
            notification.className = 'floating-notification';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // --- Data Persistence ---

        function saveProgress() {
            const data = {
                userName, userAvatar, userJob, userLevel, userExp, userStreak,
                completedMissions, guildLevel, guildExp, chatMessages, prayerTimes,
                lastLogin: new Date().toDateString()
            };
            localStorage.setItem('blueWindProgress', JSON.stringify(data));
        }

        function loadProgress() {
            const saved = localStorage.getItem('blueWindProgress');
            if (saved) {
                const data = JSON.parse(saved);
                userName = data.userName || 'í‘¸ë¥¸ì´';
                userAvatar = data.userAvatar || 'ğŸŒŸ';
                userLevel = data.userLevel || 1;
                userExp = data.userExp || 0;
                userStreak = data.userStreak || 1;
                completedMissions = data.completedMissions || 0;
                userJob = data.userJob || 'ìƒˆì‹ ì';
                guildLevel = data.guildLevel || 1;
                guildExp = data.guildExp || 0;
                chatMessages = data.chatMessages || [];
                
                const today = new Date().toDateString();
                const lastLogin = data.lastLogin || today;

                if (lastLogin !== today) {
                    const lastDate = new Date(lastLogin);
                    const todayDate = new Date(today);
                    const diffTime = todayDate - lastDate;
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                    
                    if (diffDays === 1) {
                        userStreak++;
                    } else if (diffDays > 1) {
                        userStreak = 1; // Reset streak if more than a day passed
                    }
                    // Reset daily tasks
                    prayerTimes = { morning: false, noon: false, evening: false };
                } else {
                    prayerTimes = data.prayerTimes || { morning: false, noon: false, evening: false };
                }

                // Restore prayer UI state
                Object.keys(prayerTimes).forEach(timeSlot => {
                    if (prayerTimes[timeSlot]) {
                        const slots = document.querySelectorAll('.prayer-time-slot');
                        if (timeSlot === 'morning' && slots[0]) slots[0].classList.add('completed');
                        if (timeSlot === 'noon' && slots[1]) slots[1].classList.add('completed');
                        if (timeSlot === 'evening' && slots[2]) slots[2].classList.add('completed');
                    }
                });
            }
            updateUI();
        }

        // --- App Initialization ---

        function initApp() {
            loadProgress();
            
            setTimeout(() => {
                showNotification(`${userName}ë‹˜, í‘¸ë¥¸ë‚˜ë¼í•™êµì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤! ğŸŒŸ`);
            }, 1000);

            // Add global event listeners for modals
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.style.display = 'none';
                    }
                });
            });
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    document.querySelectorAll('.modal').forEach(modal => modal.style.display = 'none');
                }
            });
        }

        window.addEventListener('load', initApp);
        window.addEventListener('beforeunload', saveProgress);

    </script>
</body>
</html>
ï¿½
